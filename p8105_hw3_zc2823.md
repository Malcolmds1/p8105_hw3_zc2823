Homework3_zc2823
================
2025-10-07

# Problem 1

Loading data and read ‘instacart’

``` r
data("instacart")
```

### Size and Structure of the data

``` r
n_obs <- nrow(instacart)
n_vars <- ncol(instacart)

glimpse(instacart)
```

    ## Rows: 1,384,617
    ## Columns: 15
    ## $ order_id               <int> 1, 1, 1, 1, 1, 1, 1, 1, 36, 36, 36, 36, 36, 36,…
    ## $ product_id             <int> 49302, 11109, 10246, 49683, 43633, 13176, 47209…
    ## $ add_to_cart_order      <int> 1, 2, 3, 4, 5, 6, 7, 8, 1, 2, 3, 4, 5, 6, 7, 8,…
    ## $ reordered              <int> 1, 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1,…
    ## $ user_id                <int> 112108, 112108, 112108, 112108, 112108, 112108,…
    ## $ eval_set               <chr> "train", "train", "train", "train", "train", "t…
    ## $ order_number           <int> 4, 4, 4, 4, 4, 4, 4, 4, 23, 23, 23, 23, 23, 23,…
    ## $ order_dow              <int> 4, 4, 4, 4, 4, 4, 4, 4, 6, 6, 6, 6, 6, 6, 6, 6,…
    ## $ order_hour_of_day      <int> 10, 10, 10, 10, 10, 10, 10, 10, 18, 18, 18, 18,…
    ## $ days_since_prior_order <int> 9, 9, 9, 9, 9, 9, 9, 9, 30, 30, 30, 30, 30, 30,…
    ## $ product_name           <chr> "Bulgarian Yogurt", "Organic 4% Milk Fat Whole …
    ## $ aisle_id               <int> 120, 108, 83, 83, 95, 24, 24, 21, 2, 115, 53, 1…
    ## $ department_id          <int> 16, 16, 4, 4, 15, 4, 4, 16, 16, 7, 16, 4, 16, 2…
    ## $ aisle                  <chr> "yogurt", "other creams cheeses", "fresh vegeta…
    ## $ department             <chr> "dairy eggs", "dairy eggs", "produce", "produce…

### Examples of observations

``` r
example_rows <- instacart |> 
  slice_sample(n = 5)

example_rows
```

    ## # A tibble: 5 × 15
    ##   order_id product_id add_to_cart_order reordered user_id eval_set order_number
    ##      <int>      <int>             <int>     <int>   <int> <chr>           <int>
    ## 1  1107870      33731                 6         0  197159 train               5
    ## 2   304371      28199                 2         1   46980 train              10
    ## 3  2113105      44669                13         1   51853 train              60
    ## 4    60897      36011                 7         1  141234 train              16
    ## 5  3319391       6873                 7         1  171343 train              11
    ## # ℹ 8 more variables: order_dow <int>, order_hour_of_day <int>,
    ## #   days_since_prior_order <int>, product_name <chr>, aisle_id <int>,
    ## #   department_id <int>, aisle <chr>, department <chr>

#### Short Description of the data

The Instacart dataset contains information on 1,384,617 observations and
15 variables, each corresponding to a single product added to a
customer’s online grocery order. Each row represents one product within
an order, while columns describe identifiers, product details, and
timing information for that purchase, and multiple rows can belong to
the same order or user.

Key variables include `order_id` and `user_id` for identifying orders
and customers, `product_name` describing the purchased items, `aisle`
and `department` indicating the product’s physical or categorical
location within the store (for example, yogurt in the dairy eggs
department), and `order_dow` and `order_hour_of_day` capturing when the
purchases occurred. Also, the variable `reordered` flags whether the
product had been previously purchased by the same user.

For example, a sample of five observations shows that user 197159 placed
an order (`order_id` 1107870) where `product_id` 33731 was added as the
6th item in the cart and was not ordered by this user in the past.

#### How many aisles are there, and which aisles are the most items ordered from?

Count the number of orders from each aisle

``` r
aisle_counts <- instacart |>
  count(aisle, name = "n_orders") |>
  arrange(desc(n_orders))
```

Total number of aisles

``` r
n_aisles <- nrow(aisle_counts)
n_aisles
```

    ## [1] 134

Display the top aisles by number of items ordered

``` r
head(aisle_counts, 10)
```

    ## # A tibble: 10 × 2
    ##    aisle                         n_orders
    ##    <chr>                            <int>
    ##  1 fresh vegetables                150609
    ##  2 fresh fruits                    150473
    ##  3 packaged vegetables fruits       78493
    ##  4 yogurt                           55240
    ##  5 packaged cheese                  41699
    ##  6 water seltzer sparkling water    36617
    ##  7 milk                             32644
    ##  8 chips pretzels                   31269
    ##  9 soy lactosefree                  26240
    ## 10 bread                            23635

##### Answer

There are 134 aisles in the Instacart dataset. Among them, the aisles
with the largest number of items ordered are fresh vegetables (150,609
orders) and fresh fruits (150,473 orders), followed by packaged
vegetables fruits, yogurt, and packaged cheese.

#### Make a plot that shows the number of items ordered in each aisle, limiting this to aisles with more than 10000 items ordered. Arrange aisles sensibly, and organize the plot

Count and keep aisles with \> 10,000 items ordered and Plot

``` r
instacart %>%
  count(aisle, name = "items_ordered") %>%
  filter(items_ordered > 10000) %>%
  mutate(aisle = fct_reorder(aisle, items_ordered)) %>%
  ggplot(aes(x = aisle, y = items_ordered)) +
  geom_col(width = 0.7, fill = "steelblue") + 
  coord_flip() +
  scale_y_continuous(
    labels = label_comma(),
    expand = expansion(mult = c(0, 0.05))
  ) +
  labs(
    title = "Number of Items Ordered by Aisle (>10,000)",
    x = "Aisle",
    y = "Items Ordered"
  ) +
  theme_minimal(base_size = 9) +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),
    axis.text.y = element_text(size = 6),
    panel.grid.major.y = element_blank()
  )
```

<img src="p8105_hw3_zc2823_files/figure-gfm/unnamed-chunk-7-1.png" width="90%" />

#### Make a table showing the three most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”.

Three target aisles

``` r
target_aisles <- c("baking ingredients", "dog food care", "packaged vegetables fruits")
```

Find top 3 products in each aisle

``` r
top3_items <- instacart %>%
  filter(aisle %in% target_aisles) %>%
  group_by(aisle, product_name) %>%
  summarize(`Times item ordered` = n(), .groups = "drop_last") %>%
  slice_max(`Times item ordered`, n = 3) %>%
  arrange(aisle, desc(`Times item ordered`))
```

Display as a clean table

``` r
kable(top3_items, caption = "Top 3 Most Frequently Ordered Products in Selected Aisles")
```

| aisle | product_name | Times item ordered |
|:---|:---|---:|
| baking ingredients | Light Brown Sugar | 499 |
| baking ingredients | Pure Baking Soda | 387 |
| baking ingredients | Cane Sugar | 336 |
| dog food care | Snack Sticks Chicken & Rice Recipe Dog Treats | 30 |
| dog food care | Organix Chicken & Brown Rice Recipe | 28 |
| dog food care | Small Dog Biscuits | 26 |
| packaged vegetables fruits | Organic Baby Spinach | 9784 |
| packaged vegetables fruits | Organic Raspberries | 5546 |
| packaged vegetables fruits | Organic Blueberries | 4966 |

Top 3 Most Frequently Ordered Products in Selected Aisles

#### Make a table showing the mean hour of the day at which Pink Lady Apples and Coffee Ice Cream are ordered on each day of the week

Target two products

``` r
target_products <- c("Pink Lady Apples", "Coffee Ice Cream")
```

Make labels

``` r
dow_labels <- c("Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat")
```

Calculate the mean hour and transform it into a wider format

convert decimal hour to HH:MM format

``` r
convert_to_time <- function(x) {
  hour <- floor(x)
  minute <- round((x - hour) * 60)
  sprintf("%02d:%02d", hour, minute)
}
```

``` r
mean_hour_table <- instacart %>%
  filter(product_name %in% target_products) %>%
  mutate(order_dow = factor(order_dow, levels = 0:6, labels = dow_labels)) %>%
  group_by(product_name, order_dow) %>%
  summarize(mean_hour = mean(order_hour_of_day), .groups = "drop") %>%
  mutate(mean_hour_fmt = convert_to_time(mean_hour)) %>%
  select(-mean_hour) %>%
  pivot_wider(
    names_from = order_dow,
    values_from = mean_hour_fmt
  ) %>%
  arrange(product_name)
```

Output a clean table

``` r
kable(
  mean_hour_table,
  caption = "Mean Order Time of Day (HH:MM) for Selected Items"
)
```

| product_name     | Sun   | Mon   | Tue   | Wed   | Thu   | Fri   | Sat   |
|:-----------------|:------|:------|:------|:------|:------|:------|:------|
| Coffee Ice Cream | 13:46 | 14:19 | 15:23 | 15:19 | 15:13 | 12:16 | 13:50 |
| Pink Lady Apples | 13:26 | 11:22 | 11:42 | 14:15 | 11:33 | 12:47 | 11:56 |

Mean Order Time of Day (HH:MM) for Selected Items

# Problem 2

Import, clean, and tidy the datasets

``` r
zillow_long <-
  read_csv("data/Zip_zori.csv") |>
  pivot_longer(
    -(RegionID:CountyName),           
    names_to  = "month",
    values_to = "zori"
  ) |>
  janitor::clean_names() |>
  rename(zip_code = region_name) |>
  mutate(
    month    = ymd(month),           
    year     = floor_date(month, "year"),
    zip_code = as.numeric(zip_code)
  ) |>
  select(-county_name) |>
  arrange(zip_code, month)
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
zip_meta =
  read_csv("data/Zip_Codes.csv", na = c("NA", ".", "")) |>
  janitor::clean_names() 
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Make zipcode distinct

``` r
zip_meta <- zip_meta |> distinct(zip_code, .keep_all = TRUE)
```

Merge

``` r
zillow_df =
  left_join(zillow_long, zip_meta, by="zip_code") 
```

#### How many ZIP codes are observed 116 times? How many are observed fewer than 10 times? Why are some ZIP codes are observed rarely and others observed in each month?

``` r
zip_counts <- zillow_long |> 
  group_by(zip_code) |> 
  summarise(n_obs = sum(!is.na(zori)), .groups = "drop")

n_zip_all_116 <- zip_counts |> filter(n_obs == 116) |> nrow()
n_zip_lt_10   <- zip_counts |> filter(n_obs < 10)  |> nrow()
```

Between January 2015 and August 2024 — a total of 116 months — there are
48 ZIP codes that are observed in all 116 months, and 26 ZIP codes that
are observed fewer than 10 times. ZIP codes that appear in every month
likely correspond to well-established residential neighborhoods with
stable housing markets and consistent Zillow coverage. In contrast, ZIP
codes observed rarely (fewer than 10 times) often represent PO Box
regions, non-residential or industrial areas, or newly created ZIP codes
that Zillow’s dataset does not consistently track.

#### A table showing the average rental price in each borough and year.

summarize mean ZORI by borough and year and make a table

``` r
zillow_df |>
  mutate(
    borough = case_match(
      county,
      "Bronx" ~ "Bronx",
      "Kings" ~ "Brooklyn",
      "New York" ~ "Manhattan",
      "Queens" ~ "Queens",
      "Richmond" ~ "Staten Island"
    ),
      year = year(month)) |>
  group_by(borough, year) |>
  summarise(avg_rent = mean(zori, na.rm = TRUE), .groups = "drop") |>
  pivot_wider(
    names_from = year,
    values_from = avg_rent
  ) |>
  mutate(across(where(is.numeric), ~round(.x, 0))) |>
  kable(
    digits = 0,
    caption = "Average Zillow Rental Index (ZORI) by Borough and Year, 2015–2024"
  )
```

| borough       | 2015 | 2016 | 2017 | 2018 | 2019 | 2020 | 2021 | 2022 | 2023 | 2024 |
|:--------------|-----:|-----:|-----:|-----:|-----:|-----:|-----:|-----:|-----:|-----:|
| Bronx         | 1760 | 1520 | 1544 | 1639 | 1706 | 1811 | 1858 | 2054 | 2285 | 2497 |
| Brooklyn      | 2493 | 2520 | 2546 | 2547 | 2631 | 2555 | 2550 | 2868 | 3015 | 3126 |
| Manhattan     | 3022 | 3039 | 3134 | 3184 | 3310 | 3107 | 3137 | 3778 | 3933 | 4078 |
| Queens        | 2215 | 2272 | 2263 | 2292 | 2388 | 2316 | 2211 | 2406 | 2562 | 2694 |
| Staten Island |  NaN |  NaN |  NaN |  NaN |  NaN | 1978 | 2045 | 2147 | 2333 | 2536 |

Average Zillow Rental Index (ZORI) by Borough and Year, 2015–2024

Across all five boroughs, average rental prices show a steady upward
trend from 2015 to 2024. Manhattan consistently has the highest rental
prices, followed by Brooklyn and Queens, while the Bronx remains the
most affordable area. After 2020, rental prices in all boroughs appear
to rise more sharply, likely reflecting post-pandemic recovery and
inflation-driven increases in housing demand.

#### Make a plot showing NYC Rental Prices within ZIP codes for all available years

Calculate average rent

``` r
avg_rent <- 
  zillow_df %>%
  mutate(
    borough = case_match(
      county,
      "Bronx" ~ "Bronx",
      "Kings" ~ "Brooklyn",
      "New York" ~ "Manhattan",
      "Queens" ~ "Queens",
      "Richmond" ~ "Staten Island",
      .default = NA_character_
    ),
    year = year(month)
  ) %>%
  group_by(borough, year) %>%
  summarise(AvgRent = mean(zori, na.rm = TRUE), .groups = "drop") %>%
  pivot_wider(names_from = borough, values_from = AvgRent)
```

Pivot longer

``` r
avg_rent_long <- avg_rent %>%
  pivot_longer(
    cols = -year,
    names_to = "borough",
    values_to = "AvgRent"
  )
```

Plot!!!

``` r
line_chart <- 
ggplot(avg_rent_long, aes(x = year, y = AvgRent, color = borough)) +
  geom_line(linewidth = 1) +
  geom_point(size = 2) +
  labs(
    title = "NYC Rental Prices within ZIP Codes for All Available Years",
    x = "Year",
    y = "Average Rental Price ($)",
    color = "Borough"
  ) +
  scale_x_continuous(
    breaks = seq(min(avg_rent_long$year, na.rm = TRUE),
                 max(avg_rent_long$year, na.rm = TRUE),
                 by = 1)
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "right",
    axis.text.x = element_text(angle = 45, hjust = 1),
    plot.title = element_text(face = "bold")
  )

line_chart
```

    ## Warning: Removed 5 rows containing missing values or values outside the scale range
    ## (`geom_line()`).

    ## Warning: Removed 5 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

<img src="p8105_hw3_zc2823_files/figure-gfm/unnamed-chunk-24-1.png" width="90%" />

The plot shows that rental prices have generally increased across all
NYC boroughs from 2015 to 2024. Manhattan remains the most expensive
area, followed by Brooklyn and Queens, while the Bronx and Staten Island
have lower average rents. A brief dip or plateau around 2020–2021 likely
reflects the COVID-19 pandemic’s impact, but prices rose sharply
afterward, suggesting a strong post-pandemic recovery in the housing
market.

#### Plot showing the distribution of ZIP-code-level rental prices across boroughs

Compute the average rental price within each ZIP code over each month in
2023

``` r
zip_2023 <-
  zillow_df %>%
  mutate(
    borough = case_match(
      county,
      "Bronx" ~ "Bronx",
      "Kings" ~ "Brooklyn",
      "New York" ~ "Manhattan",
      "Queens" ~ "Queens",
      "Richmond" ~ "Staten Island",
      .default = NA_character_
    ),
    year = year(month)
  ) %>%
  filter(year == 2023, !is.na(borough)) %>%
  group_by(borough, zip_code) %>%
  summarise(avg_rent_2023 = mean(zori, na.rm = TRUE), .groups = "drop")
```

Make box plot

``` r
box_plot <- 
ggplot(zip_2023, aes(x = borough, y = avg_rent_2023, fill = borough)) +
  geom_boxplot(alpha = 0.7, outlier.alpha = 0.6) +
  labs(
    title = "Distribution of ZIP-Code-Level Rental Prices by Borough (2023)",
    x = "Borough",
    y = "Average Rental Price ($)"
  ) +
  theme_minimal(base_size = 12) +
  theme(
    legend.position = "none",
    axis.text.x = element_text(face = "bold")
  )

box_plot
```

    ## Warning: Removed 24 rows containing non-finite outside the scale range
    ## (`stat_boxplot()`).

<img src="p8105_hw3_zc2823_files/figure-gfm/unnamed-chunk-26-1.png" width="90%" />

The boxplot shows clear differences in ZIP-level rental prices across
NYC boroughs in 2023. Manhattan has the highest median rent and the
widest range, reflecting both high prices and greater variation within
the borough. Brooklyn follows with slightly lower but still elevated
rents, while Queens and Bronx sits in the mid-range. The Staten Island
have the lowest and most compact distributions, indicating relatively
affordable and stable rental markets.

#### Combine the two plots

``` r
combined_plot <- line_chart / box_plot

combined_plot
```

    ## Warning: Removed 5 rows containing missing values or values outside the scale range
    ## (`geom_line()`).

    ## Warning: Removed 5 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

    ## Warning: Removed 24 rows containing non-finite outside the scale range
    ## (`stat_boxplot()`).

<img src="p8105_hw3_zc2823_files/figure-gfm/unnamed-chunk-27-1.png" width="90%" />

``` r
ggsave(
  filename = "results/nyc_rentals_combined.png",
  plot = combined_plot,
  width = 8,
  height = 10,
  dpi = 300
)
```

    ## Warning: Removed 5 rows containing missing values or values outside the scale range
    ## (`geom_line()`).

    ## Warning: Removed 5 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

    ## Warning: Removed 24 rows containing non-finite outside the scale range
    ## (`stat_boxplot()`).

# Problem 3

Read demographic and accelerometer data

``` r
nhanes_covar <- read_csv("data/nhanes_covar.csv", skip = 4)
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
nhanes_accel <- read_csv("data/nhanes_accel.csv")
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

Merge

``` r
nhanes_merged <- nhanes_accel %>%
  left_join(nhanes_covar, by = "SEQN")
```

Exclude participants \< 21 years old or with missing demographic data

``` r
nhanes_clean <- nhanes_merged %>%
  filter(age >= 21) %>%
  drop_na(sex, education, age, BMI)
```

Convert variables to appropriate classes

``` r
nhanes_clean <- nhanes_clean %>%
  mutate(
    sex = recode_factor(sex, "1" = "Male", "2" = "Female"),
    education = recode_factor(
      education,
      "1" = "Less than high school",
      "2" = "High school or GED",
      "3" = "More than high school",
      .ordered = TRUE
    )
  )
```

#### Table for the number of men and women in each education category

``` r
edu_sex_table <- nhanes_clean %>%
  group_by(education, sex) %>%
  summarize(`Number of participants` = n(), .groups = "drop") %>%
  pivot_wider(
    names_from = sex,
    values_from = `Number of participants`
  )

kable(
  edu_sex_table,
  caption = "Number of Men and Women by Education Category"
)
```

| education             | Male | Female |
|:----------------------|-----:|-------:|
| Less than high school |   27 |     28 |
| High school or GED    |   35 |     23 |
| More than high school |   56 |     59 |

Number of Men and Women by Education Category

The table shows that the number of men and women is relatively balanced
across education levels, though slightly more participants, both male
and female, fall into the “more than high school” category.

#### Visualization of the age distributions for men and women in each education category

``` r
ggplot(nhanes_clean, aes(x = age, fill = sex)) +
  geom_density(alpha = 0.5) +
  facet_wrap(~education, ncol = 1) +
  theme_minimal() +
  labs(
    title = "Age Distributions by Sex within Each Education Category",
    x = "Age (years)",
    y = "Density",
    fill = "Sex"
  )
```

<img src="p8105_hw3_zc2823_files/figure-gfm/unnamed-chunk-33-1.png" width="90%" />

From the age distribution plots, participants with more than high school
education tend to cluster at younger ages, while those with less than
high school education show a wider spread extending into older ages.
Gender differences in age distribution are minimal overall, although
women appear slightly younger on average in the higher education groups.

#### Plot total activities against age

Calculate total activity over the day

``` r
nhanes_total <- nhanes_clean %>%
  mutate(
    total_activity = rowSums(across(starts_with("min")), na.rm = TRUE)
  ) %>%
  distinct(SEQN, age, sex, education, total_activity)
```

Visualization

``` r
ggplot(nhanes_total, aes(x = age, y = total_activity, color = sex)) +
  geom_point(alpha = 0.5, size = 1.5) +
  geom_smooth(method = "loess", se = TRUE, linewidth = 0.8) +
  facet_wrap(~ education, nrow = 1) +
  scale_color_viridis_d(option = "plasma", end = 0.8) +
  scale_y_continuous(labels = label_comma()) +
  labs(
    title = "Daily Total Physical Activity by Age, Sex, and Education Level",
    x = "Age",
    y = "Total Activity (minutes)",
    color = "sex"
  ) +
  theme_minimal(base_size = 11) +
  theme(
    plot.title   = element_text(face = "bold", hjust = 0.5),
    legend.position = "bottom",
    legend.title = element_blank(),
    strip.text   = element_text(face = "bold"),
    panel.grid.minor = element_blank(),
    panel.spacing = unit(1, "lines")
  )
```

    ## `geom_smooth()` using formula = 'y ~ x'

<img src="p8105_hw3_zc2823_files/figure-gfm/unnamed-chunk-35-1.png" width="90%" />

The figure shows that total daily physical activity tends to decline
with age across all education groups. Participants with less than high
school education exhibit the steepest decrease, suggesting that older
adults in this group are considerably less active. Those with more than
high school education maintain relatively stable activity levels through
middle age, followed by a gradual decline. Differences between men and
women are modest overall. Among younger adults, women show slightly
higher total activity on average. At older ages, the two lines converge,
indicating comparable activity levels between sexes. Overall, the plot
highlights an inverse relationship between age and daily activity,
consistent across education levels but varying in magnitude.

#### Three-panel plot that shows the 24-hour activity time courses for each education level

Pivot longer

``` r
nhanes_long <- nhanes_clean %>%
  pivot_longer(
    cols = starts_with("min"),
    names_to = "minute",
    values_to = "MIMS"
  ) %>%
  mutate(
    minute = as.numeric(str_remove(minute, "min")),
    hour = floor((minute - 1) / 60)  # 0–23
  )
```

Summarize hourly mean by sex and education

``` r
hourly_activity <- nhanes_long %>%
  group_by(education, sex, hour) %>%
  summarize(mean_MIMS = mean(MIMS, na.rm = TRUE), .groups = "drop")
```

Plot

``` r
ggplot(hourly_activity, aes(x = hour, y = mean_MIMS, color = sex)) +
  geom_line(linewidth = 0.5) +
  facet_wrap(~ education, ncol = 1) +
  geom_smooth(se = FALSE, linewidth = 0.6, linetype = "dashed") +
  scale_x_continuous(breaks = seq(0, 24, by = 4)) +
  scale_color_manual(values = c("Male" = "#2B6CB0", "Female" = "#E53E3E")) +
  labs(
    title = "24-hour Activity Patterns by Education Level and Sex",
    x = "Hour of Day",
    y = "Average Activity (mean MIMS)",
    color = "Sex"
  ) +
  theme_minimal(base_size = 11) +
  theme(
    plot.title = element_text(face = "bold", size = 13, hjust = 0.5),
    strip.text = element_text(face = "bold"),
    panel.grid.minor = element_blank()
  )
```

    ## `geom_smooth()` using method = 'loess' and formula = 'y ~ x'

<img src="p8105_hw3_zc2823_files/figure-gfm/unnamed-chunk-38-1.png" width="90%" />

Activity levels are lowest during the early morning hours, increase
rapidly after approximately 6–8 AM, and peak around midday (10 AM–2 PM)
before gradually declining through the evening. Across panels,
individuals with more than high school education exhibit slightly higher
overall activity levels throughout the day, whereas those with less than
high school education display lower and more variable activity. Sex
differences are modest: both men and women follow nearly identical daily
cycles, although women tend to maintain slightly higher activity levels
in the afternoon hours.
